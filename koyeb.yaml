# Koyeb deployment configuration for Crypto-Orchestrator
# Documentation: https://www.koyeb.com/docs/reference/koyeb-cli

# Alternative to Render.com
# Free tier: 2 services, 512MB RAM each

app:
  name: cryptoorchestrator

services:
  # FastAPI Backend Service
  backend:
    name: backend
    type: web
    instance_type: nano  # Free tier
    regions:
      - fra  # Frankfurt (Europe)
    env:
      - PYTHON_VERSION=3.11
      - NODE_ENV=production
      - PORT=8000
    env_vars:
      # These should be set via Koyeb dashboard or CLI for security
      - DATABASE_URL
      - REDIS_URL
      - SECRET_KEY
      - JWT_SECRET_KEY
      - CORS_ORIGINS
      - ENABLE_RATE_LIMITING=true
      - ENABLE_SECURITY_HEADERS=true
    ports:
      - port: 8000
        protocol: http
    routes:
      - path: /
        port: 8000
    health_checks:
      - http:
          port: 8000
          path: /health
    autoscaling:
      min: 1
      max: 1
    docker:
      dockerfile: Dockerfile
    git:
      branch: main
      build_command: pip install -r requirements.txt
      run_command: uvicorn server_fastapi.main:app --host 0.0.0.0 --port $PORT
